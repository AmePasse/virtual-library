{% extends "library/base.html" %}

{% block content %}
    <h2>Add a Book from URL</h2>
    <p>Paste a link from Google Books or Amazon to find and add a book.</p>

    {# --- FORM DI RICERCA URL --- #}
    <form method="POST" class="search-form" style="background: #f9f9f9; padding: 20px; border-radius: var(--border-radius); margin-bottom: 2em;">
        {% csrf_token %}
        <div style="display: flex; gap: 20px; align-items: flex-end;">
            <div style="flex-grow: 1;">
                <label for="url">Book URL</label>
                <input type="url" name="url" id="url" placeholder="https://..." required style="width: 100%;">
            </div>
            <div>
                <button type="submit" name="fetch_url" class="btn">Find Book</button>
            </div>
        </div>
    </form>
    
    <hr>

    {# --- SEZIONE DI CONFERMA (appare solo dopo una ricerca) --- #}
    {% if found_book %}
        <h3>Is this your book?</h3>
        
        <form method="POST">
            {% csrf_token %}
            <div class="book-detail-container" style="background: #f9f9f9; padding: 20px; border-radius: var(--border-radius);">
                <div class="book-cover">
                    <img src="{{ found_book.cover_url }}" alt="Cover">
                </div>
                <div class="book-info">
                    <h2>{{ found_book.title }}</h2>
                    <h3>by {{ found_book.author }}</h3>
                    <p>{{ found_book.summary|truncatewords:50 }}</p>

                    <div style="display: flex; gap: 20px; margin-top: 1em;">
                        <div class="form-group">
                            <label for="bookshelf">Add to which bookshelf?</label>
                            <select name="bookshelf" required>
                                {% for shelf in bookshelves %}
                                    <option value="{{ shelf.id }}">{{ shelf.name }} (in {{ shelf.room.name }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shelf_number">On which shelf number?</label>
                            <input type="number" name="shelf_number" value="1" required>
                        </div>
                    </div>
                    <button type="submit" name="confirm_add" class="btn" style="margin-top: 1em;">Add to Library</button>
                </div>
            </div>
        </form>
        
    {% elif request.POST and not found_book %}
        <p>Sorry, we could not find a book from that URL. Please try another one.</p>
    {% endif %}

{% endblock %}